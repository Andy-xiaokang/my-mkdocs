---
comments: true
---

# Chapter7 Linking

Linking is the process of collecting and combining various pieces of code and data into a single file that can be loaded(copied) into memory and executed.  
Linkers play a crucial role in software development because they enable
*separate compilation*. Instead of organizing a large application as one monolithic
source file, we can decompose it into smaller, more manageable modules that can
be modified and compiled separately.When we change one of these modules, we
simply recompile it and relink the application, without having to recompile the
other files.

## 7.1 Compiler Drivers

![20241110233211](https://s2.loli.net/2024/11/10/C2lBA4HdvokIySw.png)

## 7.2 Static Linking

Static *linkers* such as the Linux `ld` program take as input a collection of relocatable
object files and command-line arguments and generate as output a fully linked
executable object file that can be loaded and run.

1. *Symbol resolution*. Object files define and reference symbols, where each
symbol corresponds to a function, a global variable, or a *static* variable
(i.e., any C variable declared with the `static` attribute). **The purpose of
symbol resolution is to associate each symbol reference with exactly one
symbol definition.**
2. *Relocation*. Compilers and assemblers generate code and data sections
that start at address 0. The linker relocates these sections by associating a
memory location with each symbol definition, and then modifying all of
the references to those symbols so that they point to this memory location.
The linker blindly performs these relocations using detailed instructions,
generated by the assembler, called *relocation entries*.

Object files are merely collections of blocks of bytes. Some of these blocks contain program code, others contain program data, and others contain data structures that guide the linker and loader. A linker concatenates blocks together, decides on run-time locations for the concatenated blocks, and modifies various locations within the code and data blocks. Linkers have minimal understanding of the target machine. The compilers and assemblers that generate the object files have already done most of the work.

## 7.3 Object Files

![20241111003926](https://s2.loli.net/2024/11/11/ZtGLAvD4q1RImiy.png)
![20241111005313](https://s2.loli.net/2024/11/11/TVmUBjICO3goEeW.png)

## 7.4 relocatable object files

![20241111160208](https://s2.loli.net/2024/11/11/ZLyOq7bPtDXCM6w.png)
![20241111160225](https://s2.loli.net/2024/11/11/YTFiDrCsIqNwXht.png)

## 7.5 Symbols and Symbol Tables

![20241112011843](https://s2.loli.net/2024/11/12/qShTNHCg6GMz2lV.png)
![20241112162058](https://s2.loli.net/2024/11/12/Cz9yODtib6NhTkK.png)

## 7.6 Symbol Resolution

the linker resolves symbol references by associating each reference with exactly one symbol definition from the symbol tables of its input relocatable object files.

### 7.6.1 How Linkers Resolve Duplicate Symbol Names

At compile time, the compiler exports each global symbol to the assembler as either *strong* or *weak*, and the assembler encodes this information implicitly
in the symbol table of the relocatable object file. Functions and initialized global
variables get strong symbols. Uninitialized global variables get weak symbols.

![20241113003621](https://s2.loli.net/2024/11/13/Z9o78x5DKEkbhsQ.png)

### 7.6.2 Linking with Static Libraries

In practice, all compilation systems provide a mechanism for packaging related object modules into a single file called a static library, which can then be supplied as input to the linker.When it builds the output executable, the linker copies only the object modules in the library that are referenced by the application program.

![20241113162549](https://s2.loli.net/2024/11/13/9MBhmgCRxHfF2uS.png)

### 7.6.3 How Linkers Use Static Libraries to Resolve References

![20241114000346](https://s2.loli.net/2024/11/14/ktWdJCPeMR8lDYw.png)

## 7.7 Relocation

![20241114174659](https://s2.loli.net/2024/11/14/2gznAsG6kX7EZyp.png)
![20241114174713](https://s2.loli.net/2024/11/14/C3BntQiNSkh9v1K.png)

### 7.7.1 Relocation Entries

![20241114174756](https://s2.loli.net/2024/11/14/J5FGgtNVxnQzifE.png)
![20241114174813](https://s2.loli.net/2024/11/14/1okWi5dmvSfayRt.png)

### 7.7.2 Relocating Symbol References

![20241114235930](https://s2.loli.net/2024/11/14/9fUSLua5OjcqbMZ.png)
![20241115013450](https://s2.loli.net/2024/11/15/daC6TkLmlPIxopD.png)
![20241115013532](https://s2.loli.net/2024/11/15/BuOLhAspINmcWjC.png)
![20241115013557](https://s2.loli.net/2024/11/15/OC9vd236wcMigGu.png)

## 7.8 Executable Object Files

![20241115231924](https://s2.loli.net/2024/11/15/YrTOaRgHByCQilE.png)
![20241117014535](https://s2.loli.net/2024/11/17/5YBXKHfEM2N7oks.png)

## 7.9 Loading Executable Object Files

![20241117161102](https://s2.loli.net/2024/11/17/Z3u2im5Lz7PUIj1.png)
![20241117161121](https://s2.loli.net/2024/11/17/yGQtHOD1nrkpfcI.png)

## 7.10 Dynamic Linking with Shared Libraries

Shared libraries are modern innovations that address the disadvantages of
static libraries.Ashared library is an object module that, at either run time or load
time, can be loaded at an arbitrary memory address and linked with a program in
memory. This process is known as dynamic linking and is performed by a program
called a *dynamic linker*. Shared libraries are also referred to as *shared objects*, and
on Linux systems they are indicated by the `.so` suffix. Microsoft operating systems
make heavy use of shared libraries, which they refer to as `DLLs` (dynamic link
libraries).  
Shared libraries are “shared” in two different ways. First, in any given file
system, there is exactly one `.so` file for a particular library. The code and data in
this `.so` file are shared by all of the executable object files that reference the library, as opposed to the contents of static libraries, which are copied and embedded in
the executables that reference them. Second, a single copy of the `.text` section of
a shared library in memory can be shared by different running processes  

![20241119231419](https://s2.loli.net/2024/11/19/ZTe5SUxl6m4zGKc.png)
![20241119231459](https://s2.loli.net/2024/11/19/4RtpbO7oIu6YXsk.png)

